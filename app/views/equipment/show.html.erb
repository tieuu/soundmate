<div class="container">

  <div class="flick-title banner">
    <div class="row">
      <div class="col-10 offset-1 col-lg-8 offset-lg-2 my-3">
        <h2 class='m-5'>Rent</h2>
      </div>
    </div>
  </div>

  <div class="card-trip my-3" style="background: white;">
    <div class="flex-container">
      <ul class="list-group list-group-flush" style="width: 50%;">
        <div class="card-header" style="background: white;">
          <h1 class="text-center" id="black"><%= @equipment.ad_name %> </h1>
        </div>
        <li class="list-group-item border-0 text-center" id="black"> <%= @equipment.description %></li>
        <li class="list-group-item border-top-0 text-center" id="black"> <%= ActiveSupport::NumberHelper.number_to_currency(@equipment.price, locale: :ja) %></li>
        <li class="list-group-item border-top-0 border-bottom-0 text-center" id="black">Rented by: <%= @equipment.user.name %></li>
        <li class="list-group-item border-bottom-0 text-center" id="black">Location: Tokyo</li>
        <% @equipment.reviews.each do |review| %>
          <li class="list-group-item border-bottom-0 text-center" id="black"><%= review.content %></li>
        <% end %>
      </ul>
      <% unless @equipment.photos.attached? %>
        <%= cl_image_tag('nd6mdgkmkyp5fok5ig9n.png', crop: :fill) %>
      <% else %>
        <div class="flex-large">
          <%= cl_image_tag(@equipment.photos.first.key, crop: :fill) %>
        </div>
        <div class="flex-small">
          <%= cl_image_tag(@equipment.photos[1].key, crop: :fill) %>
          <%= cl_image_tag(@equipment.photos[2].key, crop: :fill) %>
          <%= link_to "See more pictures", @equipment_path %>
        </div>
      <% end %>

      <div id="map"
        style="width: 100%; height: 600px;"
        data-markers="<%= @marker.to_json %>"
        data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
      </div>

      <% if @equipment.active && @equipment.user != current_user %>
        <div class="col-sm-4">
        <h2>Rental Period</h2>
        <%= simple_form_for [@equipment, @booking] do |f|  %>
          <%= f.input :start_date,
                          as: :date,
                          label: 'From',
                          html5: true%>
          <%= f.input :end_date,
                          as: :date,
                          label: 'To (include)',
                          html5: true %>
          <%= f.submit "Confirm booking", class: "btn btn-outline-light btn-md my-3" %>
        <% end %>
        </div>
      <% elsif @equipment.user == current_user %>
        <ul class="list-group">
          <% @equipment.bookings.each do |booking| %>
            <li class="list-group-item">
              <div class="row justify-content-between align-items-center pl-3">
                <div>
                  <h3 class='text-dark font-weight-bold'>
                    <%= booking.user.name %>
                  </h3>
                  <h3 class='text-dark'>
                    From <%= l(booking.start_date.to_date, format: :long) %>
                  </h3>
                  <h3 class='text-dark'>
                    To <%= l(booking.end_date.to_date, format: :long) %>
                  </h3>
                  <h3 class='text-dark'>
                    <%= ActiveSupport::NumberHelper.number_to_currency((booking.equipment.price * (booking.end_date.to_date - booking.start_date.to_date + 1)).round, locale: :ja) %>
                  </h3>
                  <h3 class='status'>
                    <%= booking.status.capitalize %>
                  </h3>
                </div>
                <div>
                  <%= simple_form_for booking, method: 'patch' do |f| %>
                    <% if booking.status == 'pending' %>
                      <button type="submit" class='btn btn-outline-success btn-md mx-3 my-1' value='confirmed' name='status'>Accept</button>
                      <br>
                      <button type="submit" class='btn btn-outline-warning btn-md mx-3 my-1' value='cancelled' name='status'>Cancel</button>
                    <% elsif booking.status == 'confirmed' %>
                      <button type="submit" class='btn btn-outline-info btn-md mx-3 my-1' value='returned' name='status'>Returned</button>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </li>
          <% end %>
        </ul>
      <% end %>
    </div>
  </div>

</div>
