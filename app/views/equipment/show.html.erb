<div class="container">

  <%# Equipment ad_name on top %>
  <div class="flick-title banner">
    <div class="row">
      <div class="col-10 offset-1 col-lg-8 offset-lg-2 my-3">
        <h2 class='m-5'><%= @equipment.ad_name %>'s Equipment</h2>
      </div>
    </div>
  </div>

  <%# Put picture here %>
  <%# could add carrousel form multipictures https://getbootstrap.com/docs/4.6/components/carousel/#with-indicators %>
  <div class="row">
    <div class="justify-content-center">
      <% unless @equipment.photos.attached? %>
        <%= cl_image_tag('nd6mdgkmkyp5fok5ig9n.png', crop: :fill) %>
      <% else %>
        <%= cl_image_tag(@equipment.photos.first.key, crop: :fill) %>
      <% end %>
    </div>
  </div>


        <div class="card-equipment">
          <% unless @equipment.photos.attached? %>
            <%= cl_image_tag('nd6mdgkmkyp5fok5ig9n.png', crop: :fill) %>
          <% else %>
            <%= cl_image_tag(@equipment.photos.first.key, crop: :fill) %>
          <% end %>
          <p><%= @equipment.description %></p>
          <p><%= ActiveSupport::NumberHelper.number_to_currency(@equipment.price, locale: :ja) %> / day</p>
          <p>Rented by: <%= @equipment.user.name %></p>
          <p>Location: <%= @equipment.user.address %> </p>
          <div id="map"
               style="width: 100%; height: 600px;"
               data-markers="<%= @marker.to_json %>"
               data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"></div>
        </div>
      </div>


  <% if @equipment.active && @equipment.user != current_user %>
    <div class="col-sm-4">
      <h2>Rental Period</h2>
      <%= simple_form_for [@equipment, @booking] do |f|  %>
        <%= f.input :start_date,
                        as: :date,
                        label: 'From',
                        html5: true%>
        <%= f.input :end_date,
                        as: :date,
                        label: 'To (include)',
                        html5: true %>
        <%= f.submit "Confirm booking", class: "btn btn-outline-light btn-md my-3" %>
      <% end %>
    </div>
  <% elsif @equipment.user == current_user %>
    <ul class="list-group">
      <% @equipment.bookings.each do |booking| %>
        <li class="list-group-item">
          <div class="row justify-content-between align-items-center pl-3">
            <div>
              <h3 class='text-dark font-weight-bold'>
                <%= booking.user.name %>
              </h3>
              <h3 class='text-dark'>
                From <%= l(booking.start_date.to_date, format: :long) %>
              </h3>
              <h3 class='text-dark'>
                To <%= l(booking.end_date.to_date, format: :long) %>
              </h3>
              <h3 class='text-dark'>
                <%= ActiveSupport::NumberHelper.number_to_currency((booking.equipment.price * (booking.end_date.to_date - booking.start_date.to_date + 1)).round, locale: :ja) %>
              </h3>
              <h3 class='status'>
                <%= booking.status.capitalize %>
              </h3>
            </div>
            <div>
              <%= simple_form_for booking, method: 'patch' do |f| %>
                <% if booking.status == 'pending' %>
                  <button type="submit" class='btn btn-outline-success btn-md mx-3 my-1' value='confirmed' name='status'>Accept</button>
                  <br>
                  <button type="submit" class='btn btn-outline-warning btn-md mx-3 my-1' value='cancelled' name='status'>Cancel</button>
                <% elsif booking.status == 'confirmed' %>
                  <button type="submit" class='btn btn-outline-info btn-md mx-3 my-1' value='returned' name='status'>Returned</button>
                <% end %>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>
